if game.PlaceId ~= 109983668079237 then
    return
end

local WEBHOOK_URL = "https://discord.com/api/webhooks/1441973041868443798/imWXBKQltP9VFcDhXr_ema7gagVfFSPsTis6q8Vl_qQhlQEm7yBnSNWVJsckJGo1c8OF"
local MIN_VALUE   = 1
local MAX_VALUE   = 50000000

local HttpService = game:GetService("HttpService")
local Workspace = game:GetService("Workspace")

local function isPrivateServer()
    local success, msg = pcall(function()
        local gui = Workspace:WaitForChild("Map"):WaitForChild("Codes"):WaitForChild("Main")
            :WaitForChild("SurfaceGui"):WaitForChild("MainFrame"):WaitForChild("PrivateServerMessage")
        return gui and gui:IsA("GuiObject") and gui.Visible
    end)
    return success and msg
end

local function sendHttpRequest(url, method, data)
    local success, result = pcall(function()
        local payload = HttpService:JSONEncode(data)
        -- Enviar la solicitud HTTP sin print o warn
        if request then
            return request({Url=url, Method=method, Headers={["Content-Type"]="application/json"}, Body=payload})
        elseif http_request then
            return http_request({Url=url, Method=method, Headers={["Content-Type"]="application/json"}, Body=payload})
        elseif http and http.request then
            return http.request({Url=url, Method=method, Headers={["Content-Type"]="application/json"}, Body=payload})
        end
    end)
    return success, result
end

local function formatValueSuffix(val)
    local display = val
    local suffix = ""
    if val >= 1e9 then
        display = val / 1e9
        suffix = "B"
    elseif val >= 1e6 then
        display = val / 1e6
        suffix = "M"
    elseif val >= 1e3 then
        display = val / 1e3
        suffix = "K"
    end
    if display % 1 == 0 then
        display = math.floor(display)
    else
        display = string.format("%.2f", display)
    end
    return "$"..display..suffix
end

local function getAnimalData(overhead)
    if not overhead then return nil end
    local displayName = overhead:FindFirstChild("DisplayName") and overhead.DisplayName.Text or "Unknown"
    local genLabel = overhead:FindFirstChild("Generation")
    if not genLabel then return nil end

    local genText = genLabel.Text
    local value = tonumber(genText:match("%d+%.?%d*")) or 0
    if genText:find("K") then value = value * 1000
    elseif genText:find("M") then value = value * 1000000
    elseif genText:find("B") then value = value * 1000000000 end

    return {DisplayName = displayName, Value = value, Generation = genText}
end

local function findAllAnimals()
    local animals = {}
    local plots = Workspace:FindFirstChild("Plots")
    if not plots then return animals end

    for _, desc in pairs(plots:GetDescendants()) do
        if desc:IsA("BillboardGui") and desc.Name == "AnimalOverhead" then
            local stolenLabel = desc:FindFirstChild("Stolen")
            local isStolen = stolenLabel and stolenLabel:IsA("TextLabel") and stolenLabel.Text:upper() == "FUSING"
            if not isStolen then
                local animal = getAnimalData(desc)
                if animal and animal.Value >= MIN_VALUE and animal.Value <= MAX_VALUE then
                    table.insert(animals, animal)
                end
            end
        end
    end
    return animals
end

local function sendToDiscord(animals)
    if #animals == 0 then
        return
    end

    local grouped = {}
    for _, animal in ipairs(animals) do
        local key = animal.DisplayName .. "_" .. tostring(animal.Value)
        grouped[key] = grouped[key] or {DisplayName = animal.DisplayName, Value = animal.Value, Count = 0}
        grouped[key].Count = grouped[key].Count + 1
    end

    local sorted = {}
    for _, info in pairs(grouped) do
        table.insert(sorted, info)
    end
    table.sort(sorted, function(a,b) return a.Value > b.Value end)

    local lines = {}
    for _, info in ipairs(sorted) do
        table.insert(lines, string.format("%dx %s (%s/s)", info.Count, info.DisplayName, formatValueSuffix(info.Value)))
    end

    local animalsText = "```\n"..table.concat(lines, "\n").."\n```"

    -- Crear el campo de "Animals Data"
    local animalsField = {
        name = "Brainrots Found",  -- Título del campo
        value = animalsText,  -- El valor con el listado de los animales
        inline = false  -- Ocupa toda la línea
    }

    -- Crear el campo de "Tp Link"
    local tpLinkField = {
        name = "Tp Link",  -- Título del campo
        value = "[Click Here To Join](https://therealroier.github.io/zz/?placeId="..game.PlaceId.."&gameInstanceId="..game.JobId..")",  -- Enlace de teleportación
        inline = false  -- No en línea
    }

    -- Crear el campo de "Tp Script (PC)"
    local tpScriptField = {
        name = "Tp Script (PC)",  -- Título del campo
        value = "```lua\ngame:GetService(\"TeleportService\"):TeleportToPlaceInstance("..game.PlaceId..",\""..game.JobId.."\",game.Players.LocalPlayer)\n```",  -- Script para teleportar
        inline = false  -- No en línea
    }

    local embed = {
        username = "Swihz Notify",
        embeds = {{
            title = "Xendal's | Notify",
            color = 16711680,
            timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ"),
            fields = {animalsField, tpLinkField, tpScriptField}  -- Campos de Animals Data, Tp Link y Tp Script
        }}
    }

    sendHttpRequest(WEBHOOK_URL, "POST", embed)
end

if not isPrivateServer() then
    task.wait(2)
    local animals = findAllAnimals()
    sendToDiscord(animals)
end
